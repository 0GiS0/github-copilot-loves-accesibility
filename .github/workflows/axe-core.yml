name: CI Tests
on:
  pull_request:
    branches: [main]
jobs:
  axe:
    runs-on: ubuntu-latest

    steps:
      - name: "ğŸ”„ Checkout repository"
        uses: actions/checkout@v4
      - name: "ğŸŸ¢ Use Node.js 20.x"
        uses: actions/setup-node@v1
        with:
          node-version: 20.x
      - name: "ğŸ“¦ Install dependencies"
        run: yarn install
      - name: "ğŸŒ Get Chromium version"
        run: |
          CHROMIUM_VERSION=$(wget -qO- https://googlechromelabs.github.io/chrome-for-testing/LATEST_RELEASE_STABLE | cut -d. -f1)
          echo "Chromium version: $CHROMIUM_VERSION"
          echo "CHROMIUM_VERSION=$CHROMIUM_VERSION" >> $GITHUB_ENV
      - name: "ğŸŒ Setup Chrome"
        id: setup-chrome
        uses: browser-actions/setup-chrome@v1
        with:
          chrome-version: ${{ env.CHROMIUM_VERSION }}
      - name: "ğŸš— Install chromedriver"
        run: |
          echo "Installing chromedriver version: $CHROMIUM_VERSION"
          yarn add chromedriver@$CHROMIUM_VERSION
          echo "chromedriver version: $(chromedriver --version)"
      - name: "ğŸš€ Start HTTP server in background"
        run: http-server -p 5500 . &
      - name: "â³ Wait for server to start"
        run: sleep 3
      - name: "ğŸ¦¾ Run axe"
        run: |
          yarn add @axe-core/cli
          CHROMIUM_VERSION=$(google-chrome --version | cut -d' ' -f3 | cut -d'.' -f1)
          yarn add chromedriver@$CHROMIUM_VERSION
          npx axe --chromedriver-path $(yarn bin)/chromedriver http://localhost:5500/ --load-delay=1500 --exit --verbose --save axe-results.json
