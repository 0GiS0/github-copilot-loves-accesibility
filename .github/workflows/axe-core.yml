name: CI Tests
on:
  pull_request:
    branches: [main]
jobs:
  axe:
    runs-on: ubuntu-latest

    steps:
      - name: "🔄 Checkout repository"
        uses: actions/checkout@v4
      - name: "🟢 Use Node.js 20.x"
        uses: actions/setup-node@v1
        with:
          node-version: 20.x
      - name: "📦 Install dependencies"
        run: yarn install
      - name: "🌐 Get Chromium version"
        run: |
          CHROMIUM_VERSION=$(wget -qO- https://googlechromelabs.github.io/chrome-for-testing/LATEST_RELEASE_STABLE | cut -d. -f1)
          echo "Chromium version: $CHROMIUM_VERSION"
          echo "CHROMIUM_VERSION=$CHROMIUM_VERSION" >> $GITHUB_ENV
      - name: "🌐 Setup Chrome"
        id: setup-chrome
        uses: browser-actions/setup-chrome@v1
        with:
          chrome-version: ${{ env.CHROMIUM_VERSION }}
      - name: "🚗 Install chromedriver"
        run: |
          echo "Installing chromedriver version: $CHROMIUM_VERSION"
          yarn add chromedriver@$CHROMIUM_VERSION
          echo "chromedriver version: $(chromedriver --version)"
      - name: "🚀 Start HTTP server in background"
        run: http-server -p 5500 . &
      - name: "⏳ Wait for server to start"
        run: sleep 3
      - name: "🦾 Run axe"
        run: |
          yarn add @axe-core/cli
          CHROMIUM_VERSION=$(google-chrome --version | cut -d' ' -f3 | cut -d'.' -f1)
          yarn add chromedriver@$CHROMIUM_VERSION
          npx axe --chromedriver-path $(yarn bin)/chromedriver http://localhost:5500/ --load-delay=1500 --exit --verbose --save axe-results.json
